name: Quote every 4 hours

on:
  schedule:
    - cron: "0 */4 * * *"     # every 4 hours (UTC)
  workflow_dispatch:          # allow manual runs

permissions:
  contents: write             # required to push commits

jobs:
  update-quote:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout default branch
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Make data folder
        run: mkdir -p static/data

      - name: Fetch a quote (Quotable)
        run: |
          set -e
          curl -sSf https://api.quotable.io/random > static/data/quote.json
          # Ensure JSON has only the fields we want (content + author)
          cat static/data/quote.json | jq '{content: .content, author: .author, updatedAt: (now | todate)}' > static/data/quote.tmp
          mv static/data/quote.tmp static/data/quote.json

      - name: Commit & push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add static/data/quote.json
          git diff --cached --quiet && echo "No changes to commit" || git commit -m "chore: refresh quote (4h)"
          git push
